<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>السبحة الإلكترونية + أذكار</title>
<style>
  :root{
    --bg1:#000814; --bg2:#001d3d; --accent:#ff6b6b;
    --card:rgba(255,255,255,0.03); --glass:rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Tahoma,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff}
  .container{max-width:980px;margin:0 auto;padding:18px}
  header{padding:12px 0;text-align:center}
  header h1{margin:0;color:var(--accent);font-size:20px}
  .card{background:linear-gradient(180deg,var(--card),var(--glass));padding:16px;border-radius:12px;margin:14px 0;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .left{flex:1}
  .label{font-size:13px;opacity:0.9}
  .count{font-size:64px;font-weight:800;margin:8px 0;color:#fff;text-align:center}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  button.btn{background:var(--accent);border:0;color:#fff;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
  input[type=number], input[type=text]{padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.03);color:#fff}
  .beads{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  .bead{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center}
  .bead.active{background:linear-gradient(180deg,var(--accent),#ff3b3b);transform:scale(1.08)}
  .azkar-box{margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .current-zekr{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;flex:1;text-align:center;font-weight:700}
  .azkar-list{max-height:160px;overflow:auto;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-top:10px}
  .azkar-item{padding:6px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
  .small{font-size:13px;opacity:0.9}
  .settings{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  footer{text-align:center;color:rgba(255,255,255,0.6);margin-top:14px;font-size:13px}
  @media(max-width:720px){ .count{font-size:44px} .bead{width:34px;height:34px} }
</style>
</head>
<body>
<div class="container">
  <header><h1>السبحة الإلكترونية — مع أذكار قابلة للتغيير</h1></header>

  <div class="card">
    <div class="top">
      <div class="left">
        <div class="label">الذكر الحالي</div>
        <div id="currentZekr" class="current-zekr">— اختر ذكرًا أو اضغط تغيير —</div>
        <div class="azkar-box">
          <button class="btn" id="changeZekrBtn">تغيير ذكر</button>
          <button class="btn ghost" id="prevZekrBtn">السابق</button>
          <button class="btn ghost" id="nextZekrBtn">التالي</button>
          <label class="small" style="margin-left:8px">
            <input type="checkbox" id="autoChange"> تغيير تلقائي بعد كل <input id="autoAfter" type="number" value="33" style="width:70px;margin-left:6px"> تسبيح
          </label>
        </div>
      </div>

      <div style="min-width:240px;text-align:center">
        <div class="label">العدد الآن</div>
        <div id="count" class="count">0</div>
        <div class="small">الإجمالي: <span id="total">0</span></div>
      </div>
    </div>

    <div style="margin-top:12px" class="controls">
      <button class="btn" id="addBtn">+1</button>
      <button class="btn" id="add33Btn">+33</button>
      <button class="btn ghost" id="resetBtn">إعادة ضبط</button>
      <button class="btn ghost" id="clearBtn">مسح الحفظ</button>
      <label class="small">الهدف:
        <input id="targetInput" type="number" placeholder="مثال 100" style="width:100px;margin-left:6px">
        <button class="btn ghost" id="setTargetBtn">تعيين</button>
      </label>
    </div>

    <div class="beads" id="beadsWrap" aria-hidden="false"></div>
    <div class="label" id="targetInfo" style="text-align:center;margin-top:8px">لم يتم تحديد هدف</div>
  </div>

  <div class="card">
    <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div>
        <div class="label">قائمة الأذكار (يمكن إضافة ذكر جديد):</div>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <input id="newZekrInput" type="text" placeholder="اكتب ذكراً جديداً..." style="min-width:220px">
          <button class="btn" id="addZekrBtn">أضف ذكر</button>
          <button class="btn ghost" id="resetAzkarBtn">استعادة الافتراضي</button>
        </div>
      </div>
      <div style="text-align:center">
        <div class="small">اضغط على ذكر في القائمة لاختياره</div>
      </div>
    </div>

    <div class="azkar-list" id="azkarList" role="list">
      <!-- items injected here -->
    </div>
  </div>

  <footer>© التطبيق — حفظ محليٌ فقط على جهازك</footer>
</div>

<script>
/* ========== البيانات الافتراضية (حوالي 30 ذكر) ========== */
const DEFAULT_AZKAR = [
  "سُبْحَانَ اللهِ", "الْحَمْدُ للهِ", "اللَّهُ أَكْبَرُ",
  "لا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ", "أَسْتَغْفِرُ اللَّهَ",
  "اللَّهُمَّ صَلِّ وَسَلِّمْ عَلَى نَبِيِّنَا مُحَمَّد", "لا إله إلا الله",
  "سُبْحَانَ اللهِ وَبِحَمْدِهِ", "اللهم ارحمنا", "اللهم اغفر لنا",
  "اللهم أعنّي على ذكرك وشكرك وحسن عبادتك", "يا حيّ يا قيوم برحمة منك أستغيث",
  "اللهم أصلح لي ديني", "اللهم بارك لنا في أوقاتنا", "اللهم ارزقني الصبر",
  "اللهم اجعلني من الشاكرين", "اللهم اجعلني من التوّابين", "اللهم ارزقني الهداية",
  "اللهم اهدِ قلبي", "اللهم طهر قلبي", "اللهم ثبتني على الطاعة",
  "اللهم اجعل عملي خالصاً لوجهك", "اللهم اجعل لي من كل هم فرجاً",
  "اللهم اجعل لي في قلبي نوراً", "اللهم اسألك العفو والعافية",
  "استغفر الله واتوب اليه", "يا رب ارحم ضعف قلبي", "اللهم ارحم موتانا",
  "اللهم اجعلنا من عبادك المقبولين"
];

/* ========== حفظ الحالة في localStorage ========== */
const STORAGE_KEY = 'tasbih_azkar_v2';
let state = {
  count: 0,
  total: 0,
  target: null,
  azkar: DEFAULT_AZKAR.slice(),
  currentIndex: 0,       // index in azkar array
  autoChange: false,
  autoAfter: 33,
  beadsPerRow: 11
};

// تحميل الحفظ
try {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    const parsed = JSON.parse(saved);
    Object.assign(state, parsed);
    // لو لم يكن هناك azkar في الحفظ، نعوّض بالافتراضي
    if(!Array.isArray(state.azkar) || state.azkar.length === 0){
      state.azkar = DEFAULT_AZKAR.slice();
      state.currentIndex = 0;
    }
  }
} catch (e) { console.warn('خطأ عند تحميل الحفظ:', e); }

/* عناصر DOM */
const countEl = document.getElementById('count');
const totalEl = document.getElementById('total');
const beadsWrap = document.getElementById('beadsWrap');
const targetInfo = document.getElementById('targetInfo');
const currentZekrEl = document.getElementById('currentZekr');
const azkarListEl = document.getElementById('azkarList');

/* حفظ */
function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){} }

/* عرض واجهة */
function render(){
  countEl.textContent = state.count;
  totalEl.textContent = state.total;
  // ذكر حالي
  if(state.azkar && state.azkar.length > 0){
    const idx = ((state.currentIndex % state.azkar.length) + state.azkar.length) % state.azkar.length;
    currentZekrEl.textContent = state.azkar[idx];
  } else {
    currentZekrEl.textContent = '— لا يوجد أذكار —';
  }
  // هدف
  if(state.target && state.target > 0){
    targetInfo.textContent = `الهدف: ${state.target} — تبقى ${Math.max(0, state.target - state.count)} تسبيحات`;
  } else {
    targetInfo.textContent = 'لم يتم تحديد هدف';
  }
  renderBeads();
  renderAzkarList();
  saveState();
}

/* تَصوّر الخرز */
function renderBeads(){
  beadsWrap.innerHTML = '';
  const perRow = state.beadsPerRow || 11;
  const activeIndex = state.count % perRow;
  const rows = 3;
  for(let r=0;r<rows;r++){
    for(let i=0;i<perRow;i++){
      const div = document.createElement('div');
      div.className = 'bead';
      if(r===0 && i===activeIndex) div.classList.add('active');
      beadsWrap.appendChild(div);
    }
  }
}

/* قائمة الأذكار */
function renderAzkarList(){
  azkarListEl.innerHTML = '';
  state.azkar.forEach((z, idx) => {
    const item = document.createElement('div');
    item.className = 'azkar-item';
    const left = document.createElement('div');
    left.textContent = z;
    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.gap = '6px';
    // اختر
    const btn = document.createElement('button');
    btn.textContent = 'اختيار';
    btn.className = 'btn ghost';
    btn.onclick = ()=> { state.currentIndex = idx; render(); };
    // حذف
    const del = document.createElement('button');
    del.textContent = 'حذف';
    del.className = 'btn ghost';
    del.onclick = ()=> {
      if(!confirm('هل تريد حذف هذا الذكر؟')) return;
      state.azkar.splice(idx,1);
      if(state.currentIndex >= state.azkar.length) state.currentIndex = 0;
      render();
    };
    right.appendChild(btn);
    right.appendChild(del);
    item.appendChild(left);
    item.appendChild(right);
    azkarListEl.appendChild(item);
  });
  if(state.azkar.length === 0){
    azkarListEl.innerHTML = '<div class="small" style="padding:6px">قائمة الأذكار فارغة — أضف أذكارًا جديدة.</div>';
  }
}

/* الأفعال (زيادة، إعادة ضبط، الخ) */
function addOne(n=1){
  state.count += n;
  state.total += n;
  // تحقق التغيير التلقائي بعد الوصول لعدد محدد (مثلاً 33)
  if(state.autoChange && state.autoAfter > 0){
    // إذا وصلنا إلى مضاعف autoAfter (أي أنه أنهى دورة)
    if(state.count % state.autoAfter === 0){
      // نغيّر الذِكر إلى التالي عشوائياً أو تتابعيًا؟ هنا نغير عشوائياً:
      changeZekrRandom();
    }
  }
  render();
  checkTarget();
}
function resetCount(){
  if(!confirm('هل تريد إعادة ضبط العَدّ إلى صفر؟')) return;
  state.count = 0;
  state.total = 0;
  render();
}
function clearStorage(){
  if(!confirm('هل تريد مسح الحفظ واستعادة الإعدادات الافتراضية؟')) return;
  localStorage.removeItem(STORAGE_KEY);
  // إعادة الحالة
  state = {
    count:0,total:0,target:null,azkar:DEFAULT_AZKAR.slice(),
    currentIndex:0,autoChange:false,autoAfter:33,beadsPerRow:11
  };
  render();
}
function setTarget(){
  const val = parseInt(document.getElementById('targetInput').value);
  if(isNaN(val) || val <= 0){ alert('ضع رقماً صحيحاً أكبر من صفر'); return; }
  state.target = val;
  render();
}
function checkTarget(){
  if(state.target && state.count >= state.target){
    setTimeout(()=> alert(`تهانينا! وصلت للهدف (${state.target})`), 200);
  }
}

/* تغيير الأذكار */
function changeZekrRandom(){
  if(!state.azkar || state.azkar.length === 0) return;
  // اختر فهرس جديد عشوائي مختلف عن الحالي إن أمكن
  if(state.azkar.length === 1) { state.currentIndex = 0; return; }
  let newIdx = state.currentIndex;
  let attempts = 0;
  while(newIdx === state.currentIndex && attempts < 8){
    newIdx = Math.floor(Math.random() * state.azkar.length);
    attempts++;
  }
  state.currentIndex = newIdx;
  render();
}
function nextZekr(){
  if(!state.azkar || state.azkar.length === 0) return;
  state.currentIndex = (state.currentIndex + 1) % state.azkar.length;
  render();
}
function prevZekr(){
  if(!state.azkar || state.azkar.length === 0) return;
  state.currentIndex = (state.currentIndex - 1 + state.azkar.length) % state.azkar.length;
  render();
}

/* إضافة ذكر جديد */
document.getElementById('addZekrBtn').addEventListener('click', ()=>{
  const input = document.getElementById('newZekrInput');
  const txt = (input.value || '').trim();
  if(!txt){ alert('اكتب ذكرًا ثم اضغط إضافة'); return; }
  state.azkar.push(txt);
  input.value = '';
  state.currentIndex = state.azkar.length - 1;
  render();
});

/* استعادة الافتراضي */
document.getElementById('resetAzkarBtn').addEventListener('click', ()=>{
  if(!confirm('هل تريد استعادة قائمة الأذكار الافتراضية؟ سيُحذف كل ما أضفته.')) return;
  state.azkar = DEFAULT_AZKAR.slice();
  state.currentIndex = 0;
  render();
});

/* أحداث الأزرار */
document.getElementById('addBtn').addEventListener('click', ()=> addOne(1));
document.getElementById('add33Btn').addEventListener('click', ()=> addOne(33));
document.getElementById('resetBtn').addEventListener('click', resetCount);
document.getElementById('clearBtn').addEventListener('click', clearStorage);
document.getElementById('setTargetBtn').addEventListener('click', setTarget);
document.getElementById('changeZekrBtn').addEventListener('click', changeZekrRandom);
document.getElementById('nextZekrBtn').addEventListener('click', nextZekr);
document.getElementById('prevZekrBtn').addEventListener('click', prevZekr);

document.getElementById('autoChange').addEventListener('change', (e)=>{
  state.autoChange = e.target.checked;
  saveState();
});
document.getElementById('autoAfter').addEventListener('change', (e)=>{
  const v = parseInt(e.target.value);
  if(!isNaN(v) && v > 0) state.autoAfter = v;
  saveState();
});

/* تفعيل القيم UI من الوضع المحفوظ */
document.getElementById('autoChange').checked = !!state.autoChange;
document.getElementById('autoAfter').value = state.autoAfter || 33;
if(state.target) document.getElementById('targetInput').value = state.target;

/* النقر على منطقة الخرزة لزيادة */
document.getElementById('beadsWrap').addEventListener('click', ()=> addOne(1));

/* مفاتيح لوحة المفاتيح: Space أو + للزيادة */
document.addEventListener('keydown', (e)=>{
  if(e.code === 'Space' || e.key === ' ') { e.preventDefault(); addOne(1); }
  if(e.key === '+') addOne(1);
});

/* واجهة: عند الضغط على ذكر في القائمة نختاره */
azkarListEl.addEventListener('click', (ev)=>{
  // الأحداث مُنشأة ديناميكياً، ولكن زر الاختيار والحذف مُعالجان عند الإنشاء
});

/* تلميح: لمس إضافي على زر +1 يضيف 1 مع صوت/اهتزاز — يمكن تطويره لاحقاً */

/* تهيئة العرض */
render();

</script>
</body>
</html>
